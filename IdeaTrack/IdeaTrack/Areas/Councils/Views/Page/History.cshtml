@using IdeaTrack.Models
@model IdeaTrack.Areas.Councils.Models.AssignedListVM

@{
    ViewData["Title"] = "L?ch s? ch?m";
    // Tính toán s? hi?n th? cho phân trang
    int fromItem = (Model.CurrentPage - 1) * Model.PageSize + 1;
    int toItem = Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount);
}

<header class="header">
    <div class="header-title">
        <h1>L?ch s? ch?m sáng ki?n</h1>
        <p>L?ch s? các l?n ch?m di?m sáng ki?n trong vai trò gi?ng viên h?i d?ng.</p>
    </div>

    <div class="user-card">
        <img src="https://i.pravatar.cc/80?img=15" class="avatar">
        <div>
            <div class="user-name">@User.Identity?.Name</div>
            <div class="user-role"><i class="fas fa-user-check"></i> Thành viên H?i d?ng</div>
        </div>
    </div>
</header>

<form method="get" action="/Councils/Page/History">
    <section class="filter-bar">
        <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" name="keyword" value="@Model.Keyword" placeholder="Tìm theo tên sáng ki?n...">
        </div>

        <div class="filter-options">
            <span>L?c theo khoa:</span>
            <select class="select-filter" name="faculty">
                <option value="">T?t c? khoa</option>
                <option>Công ngh? thông tin</option>
                <option>Kinh t?</option>
            </select>

            <select class="select-filter" name="sortOrder" onchange="this.form.submit()">
                <option value="Newest" selected="@(Model.SortOrder == "Newest")">M?i nh?t</option>
                <option value="Oldest" selected="@(Model.SortOrder == "Oldest")">Cu nh?t</option>
                <option value="ScoreDesc" selected="@(Model.SortOrder == "ScoreDesc")">Ði?m cao nh?t</option>
            </select>
        </div>
    </section>
</form>

<section class="table-container">
    <table>
        <thead>
            <tr>
                <th>TÊN SÁNG KI?N</th>
                <th>KHOA</th>
                <th>NGU?I Ð? XU?T</th>
                <th>VAI TRÒ CH?M</th>
                <th>NGÀY CH?M</th>
                <th>ÐI?M</th>
                <th>HÀNH Ð?NG</th>
            </tr>
        </thead>

        <tbody>
            @if (Model.Items != null && Model.Items.Any())
            {
                foreach (var item in Model.Items)
                {
                    <tr>
                        <td>
                            <div class="project-name">@item.Title</div>
                            <div class="initiative-code">Mã SK: @item.InitiativeCode</div>
                        </td>
                        <td>
                            <span class="faculty-badge it">@item.CategoryName</span>
                        </td>
                        <td>
                            <span class="author-name">ThS. Gi?ng Viên (Demo)</span>
                        </td>
                        <td><span class="role-badge">Thành viên</span></td>
                        <td>
                            @(item.AssignedDate.ToString("dd/MM/yyyy"))
                        </td>
                        <td>
                            <span class="score-badge">--</span>
                        </td>
                        <td>
                            <div class="d-flex gap-2">
                                <a href="/Councils/Page/Details/@item.AssignmentId"
                                   class="btn btn-sm btn-success d-flex align-items-center gap-1 text-decoration-none"
                                   title="Xem chi ti?t">
                                    <i class="bi bi-eye"></i>
                                    Xem
                                </a>

                                <a href="/Councils/Page/Details/@item.AssignmentId"
                                   class="btn btn-sm btn-warning d-flex align-items-center gap-1 text-white text-decoration-none"
                                   title="Ch?nh s?a di?m">
                                    <i class="bi bi-pencil-square"></i>
                                    S?a
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center py-4 text-muted">Không tìm th?y d? li?u ch?m di?m nào.</td>
                </tr>
            }
        </tbody>
    </table>
</section>

<footer class="pagination-container">
    @if (Model.TotalCount > 0)
    {
        <span>Hi?n th? @fromItem–@toItem trong @Model.TotalCount sáng ki?n</span>
        <div class="pagination">
            @if (Model.HasPreviousPage)
            {
                <a href="?page=@(Model.CurrentPage - 1)&keyword=@Model.Keyword&sortOrder=@Model.SortOrder" class="page-nav">
                    <i class="fas fa-chevron-left"></i>
                </a>
            }
            else
            {
                <button class="page-nav" disabled><i class="fas fa-chevron-left"></i></button>
            }

            <button class="page-num active">@Model.CurrentPage</button>

            @if (Model.HasNextPage)
            {
                <a href="?page=@(Model.CurrentPage + 1)&keyword=@Model.Keyword&sortOrder=@Model.SortOrder" class="page-nav">
                    <i class="fas fa-chevron-right"></i>
                </a>
            }
            else
            {
                <button class="page-nav" disabled><i class="fas fa-chevron-right"></i></button>
            }
        </div>
    }
</footer>
