@using IdeaTrack.Models
@model IdeaTrack.Areas.Councils.Models.AssignedListVM

@{
    ViewData["Title"] = "Lịch sử chấm";
    // Tính toán số hiển thị cho phân trang
    int fromItem = (Model.CurrentPage - 1) * Model.PageSize + 1;
    int toItem = Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount);
}

<header class="header">
    <div class="header-title">
        <h1>Lịch sử chấm sáng kiến</h1>
        <p>Lịch sử các lần chấm điểm sáng kiến trong vai trò giảng viên hội đồng.</p>
    </div>

    <div class="user-card">
        <img src="https://i.pravatar.cc/80?img=15" class="avatar">
        <div>
            <div class="user-name">@User.Identity?.Name</div>
            <div class="user-role"><i class="fas fa-user-check"></i> Thành viên Hội đồng</div>
        </div>
    </div>
</header>

<form method="get" action="/Councils/Page/History">
    <section class="filter-bar">
        <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" name="keyword" value="@Model.Keyword" placeholder="Tìm theo tên sáng kiến...">
        </div>

        <div class="filter-options">
            <span>Lọc theo khoa:</span>
            <select class="select-filter" name="faculty">
                <option value="">Tất cả khoa</option>
                <option>Công nghệ thông tin</option>
                <option>Kinh tế</option>
            </select>

            <select class="select-filter" name="sortOrder" onchange="this.form.submit()">
                <option value="Newest" selected="@(Model.SortOrder == "Newest")">Mới nhất</option>
                <option value="Oldest" selected="@(Model.SortOrder == "Oldest")">Cũ nhất</option>
                <option value="ScoreDesc" selected="@(Model.SortOrder == "ScoreDesc")">Điểm cao nhất</option>
            </select>
        </div>
    </section>
</form>

<section class="table-container">
    <table>
        <thead>
            <tr>
                <th>TÊN SÁNG KIẾN</th>
                <th>KHOA</th>
                <th>NGƯỜI ĐỀ XUẤT</th>
                <th>VAI TRÒ CHẤM</th>
                <th>NGÀY CHẤM</th>
                <th>ĐIỂM</th>
                <th>HÀNH ĐỘNG</th>
            </tr>
        </thead>

        <tbody>
            @if (Model.Items != null && Model.Items.Any())
            {
                foreach (var item in Model.Items)
                {
                    <tr>
                        <td>
                            <div class="project-name">@item.Title</div>
                            <div class="initiative-code">Mã SK: @item.InitiativeCode</div>
                        </td>
                        <td>
                            <span class="faculty-badge it">@item.CategoryName</span>
                        </td>
                        <td>
                            <span class="author-name">ThS. Giảng Viên (Demo)</span>
                        </td>
                        <td><span class="role-badge">Thành viên</span></td>
                        <td>
                            @(item.AssignedDate.ToString("dd/MM/yyyy"))
                        </td>
                        <td>
                            <span class="score-badge">--</span>
                        </td>
                        <td>
                            <div class="d-flex gap-2">
                                <a href="/Councils/Page/Details/@item.AssignmentId"
                                   class="btn btn-sm btn-success d-flex align-items-center gap-1 text-decoration-none"
                                   title="Xem chi tiết">
                                    <i class="bi bi-eye"></i>
                                    Xem
                                </a>

                                <a href="/Councils/Page/Details/@item.AssignmentId"
                                   class="btn btn-sm btn-warning d-flex align-items-center gap-1 text-white text-decoration-none"
                                   title="Chỉnh sửa điểm">
                                    <i class="bi bi-pencil-square"></i>
                                    Sửa
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center py-4 text-muted">Không tìm thấy dữ liệu chấm điểm nào.</td>
                </tr>
            }
        </tbody>
    </table>
</section>

<footer class="pagination-container">
    @if (Model.TotalCount > 0)
    {
        <span>Hiển thị @fromItem–@toItem trong @Model.TotalCount sáng kiến</span>
        <div class="pagination">
            @if (Model.HasPreviousPage)
            {
                <a href="?page=@(Model.CurrentPage - 1)&keyword=@Model.Keyword&sortOrder=@Model.SortOrder" class="page-nav">
                    <i class="fas fa-chevron-left"></i>
                </a>
            }
            else
            {
                <button class="page-nav" disabled><i class="fas fa-chevron-left"></i></button>
            }

            <button class="page-num active">@Model.CurrentPage</button>

            @if (Model.HasNextPage)
            {
                <a href="?page=@(Model.CurrentPage + 1)&keyword=@Model.Keyword&sortOrder=@Model.SortOrder" class="page-nav">
                    <i class="fas fa-chevron-right"></i>
                </a>
            }
            else
            {
                <button class="page-nav" disabled><i class="fas fa-chevron-right"></i></button>
            }
        </div>
    }
</footer>