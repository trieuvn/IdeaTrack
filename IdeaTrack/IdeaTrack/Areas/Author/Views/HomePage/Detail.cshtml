@model IdeaTrack.Areas.Author.ViewModels.InitiativeDetailViewModel

<nav class="breadcrumb">
    <a href="/Author/HomePage" class="breadcrumb-link">HomePage</a>
    <span class="breadcrumb-separator">/</span>
    <a href="/Author/HomePage/History" class="breadcrumb-link">Initiatives</a>
    <span class="breadcrumb-separator">/</span>
    <span class="breadcrumb-current">Detail</span>
</nav>

<header class="initiative-header">
    <h1>@Model.Initiative.Title</h1>
    <a href="/Author/HomePage/Edit/@Model.Initiative.Id" class="edit-btn">Edit Initiative</a>
</header>

<div class="initiative-meta">
    <span>Academic Year: @Model.Initiative.AcademicYear?.Name</span>
    <span>Category: @Model.Initiative.Category?.Name</span>
    <span>Department: @Model.Initiative.Department?.Name</span>
    <span>Code: @Model.Initiative.InitiativeCode</span>
</div>

<div class="initiative-body">
    <div class="left-panel">
        <section class="abstract">
            <h2>Description</h2>
            <p>@(string.IsNullOrEmpty(Model.Initiative.Description) ? "No description provided." : Model.Initiative.Description)</p>
        </section>

        <section class="detailed-proposal">
            <h2>Initiative Details</h2>
            <p><strong>Budget:</strong> @Model.Initiative.Budget.ToString("N0") VND</p>
            <p><strong>Created:</strong> @Model.Initiative.CreatedAt.ToString("MMMM dd, yyyy 'at' HH:mm")</p>
            @if (Model.Initiative.SubmittedDate.HasValue)
            {
                <p><strong>Submitted:</strong> @Model.Initiative.SubmittedDate.Value.ToString("MMMM dd, yyyy 'at' HH:mm")</p>
            }
        </section>

        <section class="supporting-documents">
            <h2>Supporting Documents</h2>

            <div class="documents-list">
                @if (Model.Files.Any())
                {
                    @foreach (var file in Model.Files)
                    {
                        <div class="document-item">
                            @if (file.FileType == ".pdf")
                            {
                                <i class="bi bi-file-earmark-pdf-fill file-icon pdf"></i>
                            }
                            else if (file.FileType == ".docx" || file.FileType == ".doc")
                            {
                                <i class="bi bi-file-earmark-word-fill file-icon doc"></i>
                            }
                            else if (file.FileType == ".xlsx" || file.FileType == ".xls")
                            {
                                <i class="bi bi-file-earmark-excel-fill file-icon excel"></i>
                            }
                            else
                            {
                                <i class="bi bi-file-earmark-fill file-icon"></i>
                            }
                            <div class="file-info">
                                <div class="file-name">@file.FileName</div>
                                <div class="file-meta">@((file.FileSize / 1024.0 / 1024.0).ToString("F1")) MB • Uploaded @file.UploadDate.ToString("MMM dd")</div>
                            </div>
                            <a href="@file.FilePath" download><i class="bi bi-download download-arrow"></i></a>
                        </div>
                    }
                }
                else
                {
                    <p style="color:#888;">No documents attached.</p>
                }
            </div>

            @if (Model.Files.Any())
            {
                <a href="#" class="download-all-link">
                    <i class="bi bi-download me-1"></i> Download All
                </a>
            }
        </section>
    </div>

    <aside class="right-panel">
        <section class="approval-status">
            <h2>Approval Status</h2>
            <ul class="status-steps">
                <li class="step @(Model.Initiative.Status >= IdeaTrack.Models.InitiativeStatus.Pending ? "completed" : "pending")">
                    <span class="step-circle"></span>
                    <div class="step-label">
                        <strong>Submitted</strong>
                        <small>@(Model.Initiative.SubmittedDate.HasValue ? "Completed on " + Model.Initiative.SubmittedDate.Value.ToString("MMM dd") : "Pending")</small>
                    </div>
                </li>
                <li class="step @(Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Dept_Review ? "active" : (Model.Initiative.Status > IdeaTrack.Models.InitiativeStatus.Dept_Review ? "completed" : "pending"))">
                    <span class="step-circle"></span>
                    <div class="step-label">
                        <strong>Dept. Manager Approval</strong>
                        <small>@(Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Dept_Review ? "In Progress" : (Model.Initiative.Status > IdeaTrack.Models.InitiativeStatus.Dept_Review ? "Completed" : "Pending"))</small>
                    </div>
                </li>
                <li class="step @(Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Reviewing ? "active" : (Model.Initiative.Status > IdeaTrack.Models.InitiativeStatus.Reviewing ? "completed" : "pending"))">
                    <span class="step-circle"></span>
                    <div class="step-label">
                        <strong>Board Review</strong>
                        <small>@(Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Reviewing ? "In Progress" : "Pending")</small>
                    </div>
                </li>
                <li class="step @(Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Approved || Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Rejected ? "completed" : "pending")">
                    <span class="step-circle"></span>
                    <div class="step-label">
                        <strong>Final Decision</strong>
                        <small>
                            @if (Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Approved)
                            {
                                <span style="color:green;">Approved</span>
                            }
                            else if (Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Rejected)
                            {
                                <span style="color:red;">Rejected</span>
                            }
                            else
                            {
                                <text>Pending</text>
                            }
                        </small>
                    </div>
                </li>
            </ul>
        </section>

        <section class="review-feedback">
            <h2>Review Feedback</h2>
            @if (Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Approved)
            {
                <span class="badge approved">APPROVED</span>
            }
            else if (Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Rejected)
            {
                <span class="badge rejected">REJECTED</span>
            }
            else
            {
                <span class="pending-tag">PENDING</span>
            }
            <div class="feedback-placeholder">
                <div class="placeholder-icon"></div>
                <p>Evaluation in Progress<br>Scores and comments will appear here once the review is completed.</p>
            </div>
        </section>

        @if (Model.Initiative.Status == IdeaTrack.Models.InitiativeStatus.Draft)
        {
            <section style="margin-top:24px;">
                <form asp-action="Delete" asp-route-id="@Model.Initiative.Id" method="post" onsubmit="return confirm('Are you sure you want to delete this initiative?');">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger" style="width:100%;">Delete Initiative</button>
                </form>
            </section>
        }
    </aside>
</div>