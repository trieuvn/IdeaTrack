@model IdeaTrack.ViewModels.PrivacyViewModel
@{
    ViewData["Title"] = "Initiative Submission Guide";
}

<main class="container py-5">
    <div class="row g-4">
        <div class="col-lg-8">
            <header class="mb-5">
                <h1 class="fw-bold text-dark">Initiative Submission Guide</h1>
                <p class="text-secondary fs-5">
                    Detailed procedures, required forms, and evaluation criteria to help faculty members successfully complete their initiative submissions.
                </p>
            </header>

            <section class="card border-0 shadow-sm rounded-4 mb-5" style="background-color: #fdfdfd; border-left: 5px solid #d32f2f !important;">
                <div class="card-body p-4">
                    <h5 class="fw-bold d-flex align-items-center mb-3">
                        <span class="badge bg-danger rounded-circle me-2 p-1" style="width: 24px; height: 24px; display: inline-block; font-size: 12px;">i</span>
                        Overview
                    </h5>
                    <p class="text-muted mb-0">
                        Welcome to the initiative submission guide. Practical initiatives are knowledge, skills, and techniques that authors have distilled from their work experience, bringing high efficiency in management, teaching, and scientific research. Submitting initiatives is not only a right but also a responsibility to improve the overall training quality of the Institution.
                    </p>
                </div>
            </section>

            <section>
                <h3 class="fw-bold mb-4">Submission Process</h3>
                <div class="row g-3">
                    <div class="col-md-3">
                        <div class="card h-100 border-0 shadow-sm rounded-4 p-3">
                            <div class="mb-3">
                                <span class="badge bg-danger-subtle text-danger rounded-3 px-3 py-2 fw-bold">1</span>
                            </div>
                            <h6 class="fw-bold">Prepare Documents</h6>
                            <p class="small text-muted mb-0">Download forms, fill in information, and prepare necessary supporting evidence.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card h-100 border-0 shadow-sm rounded-4 p-3">
                            <div class="mb-3">
                                <span class="badge bg-danger-subtle text-danger rounded-3 px-3 py-2 fw-bold">2</span>
                            </div>
                            <h6 class="fw-bold">Submit Online</h6>
                            <p class="small text-muted mb-0">Log in to the portal and upload your documents in PDF/DOCX format.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card h-100 border-0 shadow-sm rounded-4 p-3">
                            <div class="mb-3">
                                <span class="badge bg-danger-subtle text-danger rounded-3 px-3 py-2 fw-bold">3</span>
                            </div>
                            <h6 class="fw-bold">Council Review</h6>
                            <p class="small text-muted mb-0">The scientific council will evaluate and review your initiative.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card h-100 border-0 shadow-sm rounded-4 p-3">
                            <div class="mb-3">
                                <span class="badge bg-danger-subtle text-danger rounded-3 px-3 py-2 fw-bold">4</span>
                            </div>
                            <h6 class="fw-bold">Recognition & Awards</h6>
                            <p class="small text-muted mb-0">Receive recognition decisions and awards according to regulations.</p>
                        </div>
                    </div>
                </div>
            </section>
            <section class="mt-5">
                <h3 class="fw-bold mb-4">Document Requirements</h3>
                <div class="table-responsive bg-white rounded-4 shadow-sm p-3">
                    <table class="table table-borderless align-middle">
                        <thead class="border-bottom">
                            <tr>
                                <th class="text-muted small text-uppercase">Document Type</th>
                                <th class="text-muted small text-uppercase">Format</th>
                                <th class="text-muted small text-uppercase">Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="fw-bold">Initiative Registration Form</div>
                                    <div class="small text-muted">Form M01</div>
                                </td>
                                <td><span class="badge bg-light text-dark border">PDF/DOCX</span></td>
                                <td class="small text-muted">Must include author's signature</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="fw-bold">Initiative Description</div>
                                    <div class="small text-muted">Form M02</div>
                                </td>
                                <td><span class="badge bg-light text-dark border">PDF</span></td>
                                <td class="small text-muted">Content should not exceed 20 pages</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="fw-bold">Supporting Evidence</div>
                                    <div class="small text-muted">Photos, videos, data...</div>
                                </td>
                                <td><span class="badge bg-light text-dark border">ZIP/RAR</span></td>
                                <td class="small text-muted">Compress all documents if file size is large</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="mt-5 mb-5">
                <h3 class="fw-bold mb-4">Frequently Asked Questions</h3>
                <div class="accordion accordion-flush" id="faqAccordion">
                    <div class="accordion-item border-0 mb-3 shadow-sm rounded-4 overflow-hidden">
                        <h2 class="accordion-header">
                            <button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                When is the deadline for initiative submission?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-muted">
                                Typically, the institution accepts initiative submissions in two periods during the academic year. Period 1 is in November and Period 2 is in April each year.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item border-0 mb-3 shadow-sm rounded-4 overflow-hidden">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                How many authors can an initiative have?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-muted">
                                An initiative can be carried out by an individual or a group of authors (maximum 3 members).
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item border-0 mb-3 shadow-sm rounded-4 overflow-hidden">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                Can I edit my submission after submitting?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-muted">
                                Faculty members can only edit their submission when the status shows "Pending Revision" or before the Council begins evaluation.
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div class="col-lg-4">
            <!-- Year/Period Filter Card -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-danger bg-opacity-10 p-2 rounded-3 me-3">
                            <i class="bi bi-calendar-check text-danger fs-4"></i>
                        </div>
                        <h5 class="fw-bold mb-0">Select Period</h5>
                    </div>
                    <p class="small text-muted mb-3">Choose an academic year and period to view related documents.</p>
                    
                    <div class="mb-3">
                        <label class="form-label small text-muted text-uppercase fw-bold">Academic Year</label>
                        <select class="form-select" id="yearSelect">
                            @if (Model.AvailableYears.Any())
                            {
                                @foreach (var year in Model.AvailableYears)
                                {
                                    if (year.Id == Model.SelectedYearId)
                                    {
                                        <option value="@year.Id" selected>@year.Name @(year.IsCurrent ? "(Current)" : "")</option>
                                    }
                                    else
                                    {
                                        <option value="@year.Id">@year.Name @(year.IsCurrent ? "(Current)" : "")</option>
                                    }
                                }
                            }
                            else
                            {
                                <option value="">No active years available</option>
                            }
                        </select>
                    </div>
                    
                    <div class="mb-0">
                        <label class="form-label small text-muted text-uppercase fw-bold">Initiative Period</label>
                        <select class="form-select" id="periodSelect">
                            @if (Model.AvailablePeriods.Any())
                            {
                                @foreach (var period in Model.AvailablePeriods)
                                {
                                    if (period.Id == Model.SelectedPeriodId)
                                    {
                                        <option value="@period.Id" selected>@period.Name @(period.IsActive ? "(Active)" : "")</option>
                                    }
                                    else
                                    {
                                        <option value="@period.Id">@period.Name @(period.IsActive ? "(Active)" : "")</option>
                                    }
                                }
                            }
                            else
                            {
                                <option value="">No active periods</option>
                            }
                        </select>
                    </div>
                </div>
            </div>

            <!-- Support Documents Card -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-primary bg-opacity-10 p-2 rounded-3 me-3">
                            <i class="bi bi-folder2-open text-primary fs-4"></i>
                        </div>
                        <h5 class="fw-bold mb-0">Support Documents</h5>
                    </div>
                    <p class="small text-muted mb-3">
                        @if (!string.IsNullOrEmpty(Model.SelectedPeriodName))
                        {
                            <span>Documents for: <strong class="text-danger">@Model.SelectedPeriodName</strong></span>
                        }
                        else
                        {
                            <span>Download forms and guides to prepare your submission.</span>
                        }
                    </p>

                    <div class="list-group list-group-flush mb-4" id="documentsList">
                        @if (Model.ReferenceForms.Any())
                        {
                            @foreach (var form in Model.ReferenceForms)
                            {
                                var iconClass = form.FileType?.ToLower() switch
                                {
                                    "pdf" => "bi-file-earmark-pdf-fill text-danger",
                                    "docx" or "doc" => "bi-file-earmark-word-fill text-primary",
                                    "xlsx" or "xls" => "bi-file-earmark-excel-fill text-success",
                                    _ => "bi-file-earmark-fill text-secondary"
                                };
                                
                                <a asp-action="DownloadDocument" asp-route-id="@form.Id" class="list-group-item list-group-item-action d-flex align-items-center border-0 px-0 mb-2">
                                    <i class="bi @iconClass fs-4 me-3"></i>
                                    <div class="flex-grow-1">
                                        <div class="small fw-bold text-dark text-truncate">@form.FormName</div>
                                        <div class="text-muted" style="font-size: 11px;">@(form.FileType?.ToUpper() ?? "FILE")</div>
                                    </div>
                                    <i class="bi bi-download text-muted"></i>
                                </a>
                            }
                        }
                        else
                        {
                            <div class="text-center py-4">
                                <i class="bi bi-folder-x text-muted" style="font-size: 48px;"></i>
                                <p class="text-muted mt-2 mb-0">No documents available for this period.</p>
                            </div>
                        }
                    </div>

                    @if (Model.ReferenceForms.Any() && Model.SelectedPeriodId.HasValue)
                    {
                        <a asp-action="DownloadAllDocuments" asp-route-periodId="@Model.SelectedPeriodId" class="btn btn-outline-danger w-100 rounded-pill fw-bold py-2">
                            <i class="bi bi-file-earmark-zip me-2"></i>Download All (.zip)
                        </a>
                    }
                </div>
            </div>

            <!-- Current Status Card -->
            <div class="card border-0 shadow-sm rounded-4 mb-4 bg-danger bg-opacity-10">
                <div class="card-body p-4">
                    <h6 class="fw-bold text-danger text-uppercase small mb-3">Current Status</h6>
                    @if (Model.ActivePeriodInfo != null)
                    {
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge bg-success p-2 me-2 ripple-animation">●</span>
                            <span class="fw-bold text-dark">@Model.ActivePeriodInfo.PeriodName</span>
                        </div>
                        <p class="small text-muted mb-0">
                            Deadline: <strong>@Model.ActivePeriodInfo.EndDate.ToString("dd/MM/yyyy")</strong> 
                            (@Model.ActivePeriodInfo.DaysRemaining days remaining)
                        </p>
                    }
                    else
                    {
                        <div class="d-flex align-items-center mb-3">
                            <span class="badge bg-secondary p-2 me-2">●</span>
                            <span class="fw-bold text-dark">No Active Period</span>
                        </div>
                        <p class="small text-muted mb-0">There is no submission period currently open.</p>
                    }
                </div>
            </div>

            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body p-4">
                    <h6 class="fw-bold text-dark text-uppercase small mb-3">Need Help?</h6>
                    <div class="d-flex align-items-start mb-3">
                        <i class="bi bi-telephone text-primary me-3"></i>
                        <div>
                            <div class="small fw-bold">Science & Technology Office</div>
                            <div class="small text-muted">(028) 38.XXX.XXX (Ext: 102)</div>
                        </div>
                    </div>
                    <div class="d-flex align-items-start mb-0">
                        <i class="bi bi-envelope text-primary me-3"></i>
                        <div>
                            <div class="small fw-bold">Support Email</div>
                            <div class="small text-muted">scitech@university.edu.vn</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-warning border-0 rounded-4 p-4 shadow-sm" role="alert">
                <h6 class="alert-heading fw-bold d-flex align-items-center">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> Important Notice
                </h6>
                <p class="small mb-0 text-dark">All late submissions will be automatically transferred for review in the next period of the following academic year.</p>
            </div>
        </div>
    </div>
</main>

@section Scripts {
<script>
    document.getElementById('yearSelect').addEventListener('change', function() {
        var yearId = this.value;
        // Redirect to reload page with new year
        window.location.href = '@Url.Action("Privacy")' + '?yearId=' + yearId;
    });

    document.getElementById('periodSelect').addEventListener('change', function() {
        var periodId = this.value;
        var yearId = document.getElementById('yearSelect').value;
        // Redirect to reload page with selected period
        window.location.href = '@Url.Action("Privacy")' + '?yearId=' + yearId + '&periodId=' + periodId;
    });
</script>
}
